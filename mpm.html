<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸¸ã®å†…ãƒ‘ãƒ¼ã‚¯ã‚¤ãƒ³ åŠ ç›Ÿåº—ãƒãƒƒãƒ—</title>
    <link rel="icon" type="image/png" href="icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        #map {
            height: calc(100vh - 120px);
            width: 100%;
        }

        .legend {
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 4px 0;
            font-size: 12px;
        }

        .legend-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .custom-popup .leaflet-popup-content-wrapper {
            border-radius: 12px;
        }

        .custom-popup .leaflet-popup-content {
            margin: 12px;
        }

        .facility-popup {
            min-width: 200px;
        }

        .facility-popup h3 {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .facility-popup p {
            font-size: 12px;
            color: #666;
            margin: 2px 0;
        }

        .facility-popup .discount-info {
            background: #fef3c7;
            padding: 6px 8px;
            border-radius: 6px;
            margin-top: 8px;
            font-size: 11px;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <div class="bg-blue-600 text-white px-4 py-3">
        <h1 class="text-lg font-bold">ğŸ…¿ï¸ ä¸¸ã®å†…ãƒ‘ãƒ¼ã‚¯ã‚¤ãƒ³ åŠ ç›Ÿåº—ãƒãƒƒãƒ—</h1>
        <p class="text-xs text-blue-200">é§è»Šã‚µãƒ¼ãƒ“ã‚¹ãŒå—ã‘ã‚‰ã‚Œã‚‹æ–½è¨­</p>
    </div>

    <!-- Filter Buttons -->
    <div class="bg-white px-4 py-2 flex gap-2 overflow-x-auto border-b">
        <button id="filterAll" class="px-3 py-1 text-xs rounded-full bg-blue-600 text-white whitespace-nowrap">ã™ã¹ã¦</button>
        <button id="filterShops" class="px-3 py-1 text-xs rounded-full bg-gray-200 text-gray-700 whitespace-nowrap">ğŸ›ï¸ å•†æ¥­æ–½è¨­</button>
        <button id="filterParking" class="px-3 py-1 text-xs rounded-full bg-gray-200 text-gray-700 whitespace-nowrap">ğŸ…¿ï¸ é§è»Šå ´</button>
    </div>

    <!-- Map -->
    <div id="map"></div>

    <script>
        // åŠ ç›Ÿåº—å•†æ¥­æ–½è¨­
        const shops = [
            {
                name: "ä¸¸ãƒ“ãƒ«",
                fullName: "ä¸¸ã®å†…ãƒ“ãƒ«ãƒ‡ã‚£ãƒ³ã‚°",
                lat: 35.6815,
                lng: 139.7636,
                floors: "B1-6F",
                note: "ã‚·ãƒ§ãƒƒãƒ—ãƒ»ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³å¤šæ•°",
                type: "shop"
            },
            {
                name: "æ–°ä¸¸ãƒ“ãƒ«",
                fullName: "æ–°ä¸¸ã®å†…ãƒ“ãƒ«ãƒ‡ã‚£ãƒ³ã‚°",
                lat: 35.6825,
                lng: 139.7645,
                floors: "B1-7F",
                note: "ã‚·ãƒ§ãƒƒãƒ—ãƒ»ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³å¤šæ•°",
                type: "shop"
            },
            {
                name: "ä¸¸ã®å†…ã‚ªã‚¢ã‚¾",
                fullName: "Marunouchi OAZO",
                lat: 35.6835,
                lng: 139.7652,
                floors: "B1-6F",
                note: "ä¸¸å–„æœ¬åº—ãƒ»ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³",
                type: "shop"
            },
            {
                name: "æ±äº¬ãƒ“ãƒ«TOKIA",
                fullName: "TOKIA",
                lat: 35.6789,
                lng: 139.7645,
                floors: "B1-3F",
                note: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ãƒ»ã‚«ãƒ•ã‚§",
                type: "shop"
            },
            {
                name: "ä¸¸ã®å†…MY PLAZA",
                fullName: "æ˜æ²»å®‰ç”°ç”Ÿå‘½ãƒ“ãƒ«",
                lat: 35.6772,
                lng: 139.7620,
                floors: "B1-4F",
                note: "ã‚·ãƒ§ãƒƒãƒ—ãƒ»ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³",
                type: "shop"
            },
            {
                name: "ä¸¸ã®å†…ãƒ–ãƒªãƒƒã‚¯ã‚¹ã‚¯ã‚¨ã‚¢",
                fullName: "Marunouchi Brick Square",
                lat: 35.6800,
                lng: 139.7631,
                floors: "1-3F",
                note: "ã‚·ãƒ§ãƒƒãƒ—ãƒ»ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³",
                type: "shop"
            },
            {
                name: "iiyo!!ï¼ˆã‚¤ãƒ¼ãƒ¨ï¼‰",
                fullName: "å›½éš›ãƒ“ãƒ«",
                lat: 35.6765,
                lng: 139.7605,
                floors: "B1-3F",
                note: "ã‚·ãƒ§ãƒƒãƒ—ãƒ»ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³",
                type: "shop"
            },
            {
                name: "KITTEä¸¸ã®å†…",
                fullName: "JPã‚¿ãƒ¯ãƒ¼",
                lat: 35.6792,
                lng: 139.7660,
                floors: "B1-6F",
                note: "ã‚·ãƒ§ãƒƒãƒ—ãƒ»ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ãƒ»éƒµä¾¿å±€",
                type: "shop"
            },
            {
                name: "ä¸¸ã®å†…ãƒ†ãƒ©ã‚¹",
                fullName: "Marunouchi Terrace",
                lat: 35.6842,
                lng: 139.7638,
                floors: "1-3F",
                note: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ãƒ»ã‚«ãƒ•ã‚§",
                type: "shop"
            },
            {
                name: "TOKYO TORCH",
                fullName: "å¸¸ç›¤æ©‹ã‚¿ãƒ¯ãƒ¼",
                lat: 35.6858,
                lng: 139.7678,
                floors: "1-4F",
                note: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ãƒ»ã‚·ãƒ§ãƒƒãƒ—",
                type: "shop"
            }
        ];

        // é§è»Šå ´
        const parkings = [
            {
                name: "ä¸¸ã®å†…ãƒ‘ãƒ¼ã‚¯ãƒ“ãƒ«é§è»Šå ´",
                lat: 35.6800,
                lng: 139.7638,
                capacity: "ç´„200å°",
                type: "parking"
            },
            {
                name: "ä¸‰è±ãƒ“ãƒ«ã‚¬ãƒ¬ãƒ¼ã‚¸",
                lat: 35.6810,
                lng: 139.7628,
                capacity: "ç´„150å°",
                type: "parking"
            },
            {
                name: "ã‚ªã‚¢ã‚¾é§è»Šå ´",
                lat: 35.6838,
                lng: 139.7658,
                capacity: "ç´„300å°",
                type: "parking"
            },
            {
                name: "ä¸¸ã®å†…ä¸­å¤®ãƒ‘ãƒ¼ã‚­ãƒ³ã‚°",
                lat: 35.6805,
                lng: 139.7648,
                capacity: "ç´„100å°",
                type: "parking"
            },
            {
                name: "JPã‚¿ãƒ¯ãƒ¼é§è»Šå ´",
                lat: 35.6795,
                lng: 139.7665,
                capacity: "ç´„400å°",
                type: "parking"
            },
            {
                name: "TOKYO TORCHå¸¸ç›¤æ©‹ã‚¿ãƒ¯ãƒ¼é§è»Šå ´",
                lat: 35.6862,
                lng: 139.7685,
                capacity: "ç´„300å°",
                type: "parking"
            },
            {
                name: "æ–°æ±äº¬ãƒ“ãƒ«é§è»Šå ´",
                lat: 35.6778,
                lng: 139.7635,
                capacity: "ç´„200å°",
                type: "parking"
            },
            {
                name: "ä¸¸ã®å†…äºŒé‡æ©‹ãƒ“ãƒ«é§è»Šå ´",
                lat: 35.6768,
                lng: 139.7640,
                capacity: "ç´„250å°",
                type: "parking"
            },
            {
                name: "ä¸¸ã®å†…æ°¸æ¥½ãƒ“ãƒ«é§è»Šå ´",
                lat: 35.6832,
                lng: 139.7618,
                capacity: "ç´„150å°",
                type: "parking"
            },
            {
                name: "æ–°å›½éš›ãƒ“ãƒ«ã‚¬ãƒ¬ãƒ¼ã‚¸",
                lat: 35.6758,
                lng: 139.7598,
                capacity: "ç´„180å°",
                type: "parking"
            },
            {
                name: "æœ‰æ¥½ç”ºé›»æ°—ãƒ“ãƒ«ã‚¬ãƒ¬ãƒ¼ã‚¸",
                lat: 35.6745,
                lng: 139.7610,
                capacity: "ç´„200å°",
                type: "parking"
            },
            {
                name: "æ±äº¬ãƒ“ãƒ«é§è»Šå ´",
                lat: 35.6785,
                lng: 139.7652,
                capacity: "ç´„300å°",
                type: "parking"
            },
            {
                name: "å¤§æ‰‹ç”ºãƒ‘ãƒ¼ã‚¯ãƒ“ãƒ«é§è»Šå ´",
                lat: 35.6870,
                lng: 139.7648,
                capacity: "ç´„200å°",
                type: "parking"
            },
            {
                name: "æ–°å¤§æ‰‹ç”ºãƒ“ãƒ«ã‚¬ãƒ¬ãƒ¼ã‚¸",
                lat: 35.6878,
                lng: 139.7632,
                capacity: "ç´„180å°",
                type: "parking"
            },
            {
                name: "ä¸¸ã®å†…ä»²é€šã‚Šãƒ“ãƒ«ã‚¬ãƒ¬ãƒ¼ã‚¸",
                lat: 35.6795,
                lng: 139.7622,
                capacity: "ç´„120å°",
                type: "parking"
            }
        ];

        // ãƒãƒƒãƒ—åˆæœŸåŒ–
        const map = L.map('map').setView([35.6810, 139.7640], 16);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // ãƒãƒ¼ã‚«ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—
        const shopMarkers = L.layerGroup();
        const parkingMarkers = L.layerGroup();

        // å•†æ¥­æ–½è¨­ãƒãƒ¼ã‚«ãƒ¼ï¼ˆã‚ªãƒ¬ãƒ³ã‚¸ï¼‰
        const shopIcon = L.divIcon({
            className: 'custom-marker',
            html: '<div style="background: #f97316; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; border: 3px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3);">ğŸ›ï¸</div>',
            iconSize: [32, 32],
            iconAnchor: [16, 16],
            popupAnchor: [0, -16]
        });

        // é§è»Šå ´ãƒãƒ¼ã‚«ãƒ¼ï¼ˆé’ï¼‰
        const parkingIcon = L.divIcon({
            className: 'custom-marker',
            html: '<div style="background: #2563eb; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3);">P</div>',
            iconSize: [28, 28],
            iconAnchor: [14, 14],
            popupAnchor: [0, -14]
        });

        // å•†æ¥­æ–½è¨­ã‚’è¿½åŠ 
        shops.forEach(shop => {
            const popup = `
                <div class="facility-popup">
                    <h3>ğŸ›ï¸ ${shop.name}</h3>
                    <p>${shop.fullName}</p>
                    <p>ãƒ•ãƒ­ã‚¢: ${shop.floors}</p>
                    <p>${shop.note}</p>
                    <div class="discount-info">
                        <strong>é§è»Šã‚µãƒ¼ãƒ“ã‚¹:</strong><br>
                        3,000å††ä»¥ä¸Š â†’ 1æ™‚é–“ç„¡æ–™<br>
                        6,000å††ä»¥ä¸Š â†’ 2æ™‚é–“ç„¡æ–™<br>
                        50,000å††ä»¥ä¸Š â†’ 24æ™‚é–“ç„¡æ–™
                    </div>
                </div>
            `;
            const marker = L.marker([shop.lat, shop.lng], { icon: shopIcon })
                .bindPopup(popup, { className: 'custom-popup' });
            shopMarkers.addLayer(marker);
        });

        // é§è»Šå ´ã‚’è¿½åŠ 
        parkings.forEach(parking => {
            const popup = `
                <div class="facility-popup">
                    <h3>ğŸ…¿ï¸ ${parking.name}</h3>
                    <p>åå®¹å°æ•°: ${parking.capacity}</p>
                    <div class="discount-info">
                        <strong>æ–™é‡‘:</strong> 300å††/30åˆ†<br>
                        <strong>æœ€å¤§æ–™é‡‘:</strong> è¨­å®šãªã—ï¼ˆå¹³æ—¥ï¼‰
                    </div>
                </div>
            `;
            const marker = L.marker([parking.lat, parking.lng], { icon: parkingIcon })
                .bindPopup(popup, { className: 'custom-popup' });
            parkingMarkers.addLayer(marker);
        });

        // å…¨ãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤º
        shopMarkers.addTo(map);
        parkingMarkers.addTo(map);

        // å‡¡ä¾‹ã‚’è¿½åŠ 
        const legend = L.control({ position: 'bottomright' });
        legend.onAdd = function(map) {
            const div = L.DomUtil.create('div', 'legend');
            div.innerHTML = `
                <div class="legend-item">
                    <span class="legend-icon" style="background: #f97316;">ğŸ›ï¸</span>
                    <span>å•†æ¥­æ–½è¨­ï¼ˆåŠ ç›Ÿåº—ï¼‰</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon" style="background: #2563eb; color: white;">P</span>
                    <span>é§è»Šå ´</span>
                </div>
            `;
            return div;
        };
        legend.addTo(map);

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³
        const filterAll = document.getElementById('filterAll');
        const filterShops = document.getElementById('filterShops');
        const filterParking = document.getElementById('filterParking');

        function setActiveFilter(activeBtn) {
            [filterAll, filterShops, filterParking].forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            activeBtn.classList.remove('bg-gray-200', 'text-gray-700');
            activeBtn.classList.add('bg-blue-600', 'text-white');
        }

        filterAll.addEventListener('click', () => {
            setActiveFilter(filterAll);
            map.addLayer(shopMarkers);
            map.addLayer(parkingMarkers);
        });

        filterShops.addEventListener('click', () => {
            setActiveFilter(filterShops);
            map.addLayer(shopMarkers);
            map.removeLayer(parkingMarkers);
        });

        filterParking.addEventListener('click', () => {
            setActiveFilter(filterParking);
            map.removeLayer(shopMarkers);
            map.addLayer(parkingMarkers);
        });

        // ç¾åœ¨åœ°ã‚’è¡¨ç¤º
        if ('geolocation' in navigator) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const userIcon = L.divIcon({
                        className: 'user-marker',
                        html: '<div style="background: #22c55e; width: 16px; height: 16px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3);"></div>',
                        iconSize: [16, 16],
                        iconAnchor: [8, 8]
                    });
                    L.marker([position.coords.latitude, position.coords.longitude], { icon: userIcon })
                        .bindPopup('ç¾åœ¨åœ°')
                        .addTo(map);
                },
                (error) => {
                    console.log('ä½ç½®æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ');
                },
                { enableHighAccuracy: true }
            );
        }
    </script>
</body>
</html>
